{% extends "header.html" %}
{% block head %}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ewha Market Project</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='minha_style.css') }}">
<script src="{{ url_for('static', filename='main.js') }}" defer></script>
{% endblock head %}

{% block section %}
<section id="cart_r">
<div id="cartbody">
    <h1>장바구니</h1>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div id="cartContainer">
        {% if cart and cart.items %}
            {% for item_name, item in cart.items.items() %}
            <div class="cart-item">
                <img src="{{ url_for('static', filename='images/' + item.img_path) }}" alt="{{ item.name }}">
                <div class="cart-details">
                    <p><strong>{{ item.name }}</strong></p>
                    <p>개당 가격: <span class="unit-price">{{ "{:,}".format(item.price) }}</span>원</p>
                </div>
                <div class="quantity-control">
                    <span class="quantity-btn" onclick="decreaseQuantity(this, '{{ item_name }}')">-</span>
                    <span class="quantity">{{ item.quantity }}</span>
                    <span class="quantity-btn" onclick="increaseQuantity(this, '{{ item_name }}')">+</span>
                </div>
                <div class="total-price">
                    총 금액: <span class="item-total">{{ "{:,}".format(item.price * item.quantity) }}</span>원
                    <button class="delete-btn" onclick="removeFromCart('{{ item_name }}')">X</button>
                </div>
            </div>
            {% endfor %}
            
            <div class="grand-total">
                장바구니 총 금액: <span id="grandTotal">{{ "{:,}".format(cart.total_price) }}</span>원
            </div>

            <div class="cart-buttons">
                <div id="purchasebutton" onclick="checkout()">구매하기</div>
                <button class="clear-cart-btn" onclick="clearCart()">장바구니 비우기</button>
            </div>
        {% else %}
            <div class="empty-cart">
                <p>장바구니가 비어있습니다.</p>
                <a href="/list" class="continue-shopping">쇼핑 계속하기</a>
            </div>
        {% endif %}
    </div>
</div>
</section>
{% endblock section %}